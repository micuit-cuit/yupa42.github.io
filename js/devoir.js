function getCookie(cname) {
    let name = cname + "=";
    let decodedCookie = decodeURIComponent(document.cookie);
    let ca = decodedCookie.split(';');
    for(let i = 0; i <ca.length; i++) {
      let c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
  }
//get token in the cookie
var token = getCookie("token");
console.log(token);
//get id user in the cookie
var idUser = getCookie("idUser");
console.log(idUser);
//get type user in the cookie
var typeUser = getCookie("typeUser");
console.log(typeUser);
//if the token is not null, display the hub page
if (token == null) {
    //window.location.href = "index.html";
    }
//if the typeUser is E then set typeUserLong to "eleves"
if (typeUser == "E") {
    var typeUserLong = "eleves";
}
if (typeUser == "1") {
  var typeUserLong = "familles";
}
//if the typeUser is P then set typeUserLong to "professeurs"
if (typeUser == "P") {
    var typeUserLong = "professeurs";
}

//if the token is invalid, display the login page
fetch("https://api.ecoledirecte.com/v3/"+typeUser+"/"+idUser+"/timelineAccueilCommun.awp?verbe=get&v=4.6.0", {
  "headers": {
    "accept": "application/json, text/plain, */*",
    "accept-language": "fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7",
    "content-type": "application/x-www-form-urlencoded",
    "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"99\", \"Google Chrome\";v=\"99\"",
    "sec-ch-ua-mobile": "?0",
    "sec-ch-ua-platform": "\"Linux\"",
    "sec-fetch-dest": "empty",
    "sec-fetch-mode": "cors",
    "sec-fetch-site": "same-site",
    "x-token": token
  },
  "referrer": "https://www.ecoledirecte.com/",
  "referrerPolicy": "strict-origin-when-cross-origin",
  "body": "data={}",
  "method": "POST",
  "mode": "cors",
  "credentials": "omit"
}).then(response => response.json())
    .then(data => {
        console.log(data);
        //if the token is invalid, display the login page
        if (data.message == "Token invalide !") {
            //window.location.href = "index.html";
            console.log("Token invalide !");
        }
        if (data.message == "Session expirée !") {
            //window.location.href = "index.html";
            console.log("Session expirée !");
        }
    }
    );
  function base64DecodeUnicode(str) {
      // Convert Base64 encoded bytes to percent-encoding, and then get the original string.
      percentEncodedStr = atob(str).split('').map(function(c) {
          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join('');
  
  
      return decodeURIComponent(percentEncodedStr);
  }
      //get the actual date in the format YYYY-MM-DD
      var today = new Date();
      var dd = String(today.getDate()).padStart(2, '0');
      var mm = String(today.getMonth() + 1).padStart(2, '0');
      var yyyy = today.getFullYear();
      var date = yyyy + '-' + mm + '-' + dd;
//get devoirs in the api
fetch("https://api.ecoledirecte.com/v3/Eleves/9369/cahierdetexte.awp?verbe=get&v=4.6.0", {
  "headers": {
    "accept": "application/json, text/plain, */*",
    "accept-language": "fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7",
    "content-type": "application/x-www-form-urlencoded",
    "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"99\", \"Google Chrome\";v=\"99\"",
    "sec-ch-ua-mobile": "?0",
    "sec-ch-ua-platform": "\"Linux\"",
    "sec-fetch-dest": "empty",
    "sec-fetch-mode": "cors",
    "sec-fetch-site": "same-site",
    "x-token": "5246523556465a3556305672546b5531656e52535a335a59634568704d334e5654464e4f4e6a5a4764326f79626d7831636b784c614641765344686e565464454c33673056464270566d497a62546c4a0d0a64545a5254575a614e6c463252556c54645735444c7a647565464d4e436d4e33537a42515a574a495431706e5969746c5a454a6d633164544f556c48616d315864314e4359554e7a4d545a4c655867790d0a4f5841794d48464e53577036526b6870636e4a7962444a7a556e4a53536b5245616c4134526b637757476c73656e5269615774765432786f445170494b334133527a566a63314a444d6c5635596d52680d0a616b46755a7974774b326c34626939574e466c534d6b56494d6b5a6b4e6b644765444e7052464a6d4f5856566548527652476c6c4c31637664575a784b7a4e77555652494e47786f4e6d5577556d567a0d0a557a68325651304b647a68786143744e523368585233426859584a76644842724e54464e634668585656464b5530685764476c465431687a576938345457395855486454616c647351584632534870340d0a535563785a46517964564661656d6f3053485534545574515654686a566d4656547a494e4369397463564576576d5a4e616a646b6246463452565259626a646a6130684b595746784d47526e4f55466a0d0a647a517765566c335a305a505958704763445a5557485979566c417755585657625864336156453056304e79636c566b547939504e46707454573030627a6b30445170615432356165584a725a6c68360d0a623142765a6b5a455932343463455670517a64435a33686d53455a3259314a304d574648617a645a56335935524452775458517952555a58536d6b725255356b4b304e3356575235656a5a755a4464440d0a5248524a556a5a7252304a334b77304b57457856625556504d335a716432644454474e4463305a71556d56565758524562574679625731614e6e5a315645526865553142546b35745533426e545752510d0a526a426861564a68646b343263554a6f56554a5362444a354c3235746447784d626a41345a545a795257734e436e46724e6b38326369746b6255685a6332566f64306457636b3558616c4e69553059760d0a4d79746b5a456f7252336b3457477457566d3178516a5979646b64334d6b6b7a63553148566b647152324631576c5932647938765248466e566d74454e6b786f53557036644649784451705a614770450d0a4d47785161556458655668475130647555334a43633030354e4735686156463459316451636b466d56464e5059584e36575752545a57706f62554a745a464e6b4d31645663564a5a566c593364324a540d0a54564e4e546e4a336130396c626b5234546c4e6f5751304b616e4a56656a4e344f58706e616c55314c303833557a637a556e633556323434596e686d654456445930524851326878656c5a61534535590d0a53546461625539754d7a52575a47705153564a564f45527a61474e334d304a5657475675645764535a6a45326432704a4e33414e436b686f5758427653465247526b70474d6e6b78516b316a51564e330d0a6446593157486b7664545243643052566344565a4d446c4656537479555556734e6a424d52335a7a5a304e3564584a704d44426f59554a6f515842564d465673646d52714e4577784e6a4a526345524f0d0a4451704e63485133554756496355354563555a684d45387a52546876575764505557465a4e6c677864544a56536d6879614452614e4652525155524253586332613046364d6b4d3456544e3159564a6a0d0a4f4531734e446c3651586c715556597862474631516b3957613239755151304b4f44687853577376546a46504d4556774c314268596a6c61555764735748704c546e524e4e465a5964327848565863350d0a6253746b57533958556e55345a5763344f45316f526b49306546467865565273525564755357513063336b79533349785a6d4530616a4e71617a554e436b394c546b5a6d616d5236596e4e5a553163780d0a5333704f65545654633070735744673465587050534764735a31564254444e334c33706f637a5670516d74515433564b524559725a6d6876626c493457474e714f55307652457477"
  },
  "referrer": "https://www.ecoledirecte.com/",
  "referrerPolicy": "strict-origin-when-cross-origin",
  "body": "data={}",
  "method": "POST",
  "mode": "cors",
  "credentials": "omit"
});
fetch("https://api.ecoledirecte.com/v3/"+typeUserLong+"/"+idUser+"/cahierdetexte/2022-03-29.awp?verbe=get&v=4.6.0", {
    "headers": {
      "accept": "application/json, text/plain, */*",
      "accept-language": "fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7",
      "content-type": "application/x-www-form-urlencoded",
      "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"99\", \"Google Chrome\";v=\"99\"",
      "sec-ch-ua-mobile": "?0",
      "sec-ch-ua-platform": "\"Linux\"",
      "sec-fetch-dest": "empty",
      "sec-fetch-mode": "cors",
      "sec-fetch-site": "same-site",
      "x-token": "5246523556465a3556305672546b68614f4546684e3256494d6a6c434d58706f4f4746365754526c52326b34596e644857455a714f47685a56304a4c557938314e556c6152457878566d6861636e5a360d0a637974756346645557585a4551334d7762306c474f466c505647554e436d396d54587046576d397a5155686b5644466e536d524b6445394754546b3257566431544464355a585a584d586475595852490d0a513074575a6c64485a566b7a543070695755707a4e3252716145704e63444e7354557431526e52734e557043523359776455684b5a6b7431445170345a31526e644864445a5756694f54646a646b67350d0a5255387a4d6e6471636a64715658424d4e46645a5130744951305a79596e6c51616b4679546e524d5a585a3454324a5463565a4e5633597a595552544e6b4e30516d4a4b6554465a6147453055305a750d0a554441776141304b4e5756494d6a425862584252645456615446527653473936565746305a7a5a315479387859585572536d35524d32684d4e32747a5a58686d5433644462564e4d654778696155526f0d0a4e306c686157397364334251637a566e5753744f5330314e64454e325655527554566f4e436d3032546b5a4b57456c55546b38334c30646d536c4d325656677856325a61576a527352584e6b4f48704f0d0a4e7a4a585430524663336c44646e464a5632453352474a505357786f646d7877636b6c6e5a6d704e5448707a4d304a5357486c6b64446c69656d5a7a5154465644517043643256474b3170334e58464e0d0a6548643264456c3357537479625456364c3239775a6d35454e336c4a63546870526d7851655446714f55464c6455354255566f7657456870563142614e316c3265484e764b324e744e334a744d484e460d0a576b5a7665556830536d5a545177304b6246644852474e4b64574a4661557444614338786157744a56334e6e656c525a595539765a6d4a4355546b354b3263774c315a325232453061485a734c3159790d0a4f556874623059345246683654444e594f4373325132746863325670615531755230644c4c31597a636d344e436e7054516e63314e4664444b7a6433636a526c535731574d56566b61334a70543274340d0a5a456c6a575774444c324a6c54486c61517a68734e446c4a61305257543370615a57553353574e574b30316a5a574a525555466d4b31704f61305652565863304d7a5654626d5a6b44516f325a3256760d0a4e793950636c4a6c64325a52563035564e55465264456f3455576473616c5a6d55446c6a566e457a63455a325130465a596c4e7262446853566b4a52516b314b4e54527a576d396e556a6c79596d687a0d0a55444e54556b67356153733564325a68535555796277304b626b5a4a53576f355755746d566b6c346546704c615656536547526b516d5a44526d64525332745a6331553151315651526d4a716246644e0d0a597a41334b315a53575374695230786b4e4739715432524d52325578545864735231467752584e7453305234525734336447384e436a67786346427761476c5063446c795969746e646a6b76567974750d0a526d396a6255704e5930704b6358423061446b334f433955545552704c7a4243624656444d475a4c59586c6c61566c5a64555270534870426244466e534670754e6d355761334a3364304e3363324e740d0a4451704654316f31576c553462325a6f4e466377656c5934526b784563477056516c703264303179626a527852453543544659335155566a4f5442576345787a54575268634867344d327456544859320d0a4d466432575464475a58647059304e6161555177626d7036556b31466441304b576e466a55453568516b4a71517a6435526b7874546d393156566730533238354c33463457566c7265476c52656a4e350d0a595564354f446c4b535642525431647a51564e56553268765433524f546d645a615568465979395165456b7265574e51596e466e533364734b326f4e436c4231596d317763585634556a6c6163315a300d0a4f475535625546734d486c5a4d586c4d4d4452484e335a6b63444d314e45317053585a43526c4269515546545645396c4d7a51354e6e5a6d5630316f656a4e36625752574e6a5a32"
    },
    "referrer": "https://www.ecoledirecte.com/",
    "referrerPolicy": "strict-origin-when-cross-origin",
    "body": "data={}",
    "method": "POST",
    "mode": "cors",
    "credentials": "omit"
  }).then(response => response.json())
    .then(data => {
        console.log(data);

      //get the length of the devoirs in data.data.date.length
      var length = `${data}.data.matiere.length`;
      //loop on the length of the devoirs
      for (var i = 0; i < length; i++) {
        //creat a now card in the document end set the title of the data.data.date[i].matiere
        var card = document.createElement("div");
        card.className = "card";
        var title = document.createElement("h2");
        title.innerHTML = `${data}.data.matiere.[${i}]`;
        card.appendChild(title);
        document.getElementById("devoirs").appendChild(card);
    }
    }
    );
    
